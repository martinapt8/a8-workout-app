<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Dose Admin Dashboard</title>
    <link rel="stylesheet" href="admin-styles.css?v=20251121-1">
    <link rel="icon" type="image/png" href="../assets/daily_dose_logo_sm.png">
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="admin-sidebar">
        <div class="sidebar-brand">
            <img src="../assets/daily_dose_logo_sm.png" alt="Daily Dose Logo">
            <span class="sidebar-brand-text">Daily Dose</span>
        </div>

        <nav>
            <ul class="sidebar-nav">
                <!-- Admin Section -->
                <li class="sidebar-nav-section">
                    <span class="sidebar-nav-parent non-clickable">Admin</span>
                    <ul class="sidebar-nav-children">
                        <li><a href="index.html" class="sidebar-nav-child active">Admin Home</a></li>
                        <li><a href="https://martinapt8.github.io/a8-workout-app/?user=mritty85" class="sidebar-nav-child" target="_blank">View Main App</a></li>
                        <li><a class="sidebar-nav-child disabled">User Management</a></li>
                        <li><a class="sidebar-nav-child disabled">Reporting</a></li>
                    </ul>
                </li>

                <!-- Comms Section -->
                <li class="sidebar-nav-section">
                    <span class="sidebar-nav-parent non-clickable">Comms</span>
                    <ul class="sidebar-nav-children">
                        <li><a href="email-campaigns.html" class="sidebar-nav-child">Send Emails</a></li>
                        <li><a class="sidebar-nav-child disabled">Send Slack Updates</a></li>
                    </ul>
                </li>

                <!-- Google Admin Section -->
                <li class="sidebar-nav-section">
                    <span class="sidebar-nav-parent non-clickable">Google Admin</span>
                    <ul class="sidebar-nav-children">
                        <li><a href="sheets.html" class="sidebar-nav-child">View Sheets</a></li>
                        <li><a href="https://docs.google.com/spreadsheets/d/1IVFs2QmrevDV6pNuuuOLXtsZls8HcChnJn_qK8IHV7M/edit?gid=272721508#gid=272721508" class="sidebar-nav-child" target="_blank">Open Google Sheets</a></li>
                        <li><a href="https://script.google.com/u/0/home/projects/19-ZM76X7s6QJkvx-tkexXcdoevOk7UNziac98w70wKA_kGEf6RssoS32/edit" class="sidebar-nav-child" target="_blank">Open Apps Script Editor</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-container">
        <!-- Quick Stats -->
        <section class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">Total Active Users</div>
                <div class="stat-value" id="statActiveUsers">‚Äî</div>
                <div class="stat-meta">Users with active_user = TRUE</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Challenge</div>
                <div class="stat-value" id="statChallengeName">‚Äî</div>
                <div class="stat-meta" id="statChallengeDates">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Workouts</div>
                <div class="stat-value" id="statTotalWorkouts">‚Äî</div>
                <div class="stat-meta">For active challenge</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Last Updated</div>
                <div class="stat-value" id="statLastUpdated">‚Äî</div>
                <div class="stat-meta">Dashboard data refresh</div>
            </div>
        </section>

        <!-- Main Menu -->
        <section>
            <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Admin Tools</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <!-- Email Campaigns Card -->
                <a href="email-campaigns.html" class="card" style="text-decoration: none; color: inherit; transition: transform 0.2s ease, box-shadow 0.2s ease;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìß</div>
                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">Email Campaigns</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">
                        Create, preview, and send personalized email campaigns to users with flexible targeting and token-based personalization.
                    </p>
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--primary-black); font-weight: 600;">
                        Launch Campaign Manager
                        <span style="font-size: 1.25rem;">‚Üí</span>
                    </div>
                </a>

                <!-- User Management Card (Coming Soon) -->
                <div class="card" style="opacity: 0.6; cursor: not-allowed;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">User Management</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">
                        View, edit, and manage user accounts, preferences, and team assignments.
                    </p>
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--gray-500); font-weight: 600;">
                        Coming Soon
                    </div>
                </div>

                <!-- Analytics Card (Coming Soon) -->
                <div class="card" style="opacity: 0.6; cursor: not-allowed;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìä</div>
                    <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem;">Analytics & Reports</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">
                        View detailed analytics on user engagement, workout trends, and challenge performance.
                    </p>
                    <div style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--gray-500); font-weight: 600;">
                        Coming Soon
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid var(--gray-200); text-align: center; color: var(--gray-500); font-size: 0.875rem;">
            <p>Daily Dose Admin Dashboard v3.1 | Email Campaign System</p>
            <p style="margin-top: 0.5rem;">
                <a href="https://github.com/martinapt8/a8-workout-app" target="_blank" style="color: var(--gray-500); text-decoration: underline;">Documentation</a>
            </p>
        </footer>
    </main>

    <!-- Scripts -->
    <script src="admin-config.js?v=20251121-1"></script>
    <script src="admin-api.js?v=20251121-1"></script>
    <script>
        // Load dashboard stats on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDashboardStats();
        });

        async function loadDashboardStats() {
            try {
                // Fetch all stats in parallel
                const [activeUsersResult, challengeResult, workoutsResult] = await Promise.all([
                    ADMIN_API.getActiveUsersCount().catch(() => 0),
                    ADMIN_API.getActiveChallenge().catch(() => null),
                    ADMIN_API.getTotalWorkouts().catch(() => 0)
                ]);

                // Update active users
                document.getElementById('statActiveUsers').textContent = activeUsersResult || 0;

                // Update active challenge
                if (challengeResult && challengeResult.challenge_name) {
                    document.getElementById('statChallengeName').textContent = challengeResult.challenge_name;

                    // Format dates
                    const startDate = new Date(challengeResult.start_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const endDate = new Date(challengeResult.end_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    document.getElementById('statChallengeDates').textContent = `${startDate} - ${endDate}`;
                } else {
                    document.getElementById('statChallengeName').textContent = 'No Active Challenge';
                    document.getElementById('statChallengeDates').textContent = 'Create a challenge to get started';
                }

                // Update total workouts
                document.getElementById('statTotalWorkouts').textContent = workoutsResult || 0;

                // Update last updated time
                const now = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                document.getElementById('statLastUpdated').textContent = now;

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                showError('Failed to load dashboard statistics. Please refresh the page.');
            }
        }

        function showError(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-error';
            alert.innerHTML = `
                <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
                <div>
                    <strong>Error</strong>
                    <p style="margin-top: 0.25rem;">${message}</p>
                </div>
            `;

            const container = document.querySelector('.admin-container');
            container.insertBefore(alert, container.firstChild);
        }

        // Hover effect for clickable cards
        document.querySelectorAll('a.card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-4px)';
                card.style.boxShadow = 'var(--shadow-md)';
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = 'var(--shadow)';
            });
        });
    </script>
</body>
</html>
